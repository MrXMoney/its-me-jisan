<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - Monetag</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    body { background: #111; color: white; font-family: sans-serif; padding: 20px; }
    .section { background: #222; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
    .section h2 { margin-top: 0; }
    button { margin: 4px; padding: 6px 12px; border: none; border-radius: 5px; cursor: pointer; }
    .approve { background: limegreen; color: black; }
    .reject { background: crimson; color: white; }
    .toggle { background: #008cff; color: white; }
    .logout { background: orangered; float: right; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    td, th { border: 1px solid #444; padding: 6px; text-align: left; }
    th { background: #333; }

    .paycard {
      background: #1d1d1d;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      box-shadow: 0 2px 6px #0005;
    }
    .paycard h3 {
      margin-top: 0;
      color: #00ff80;
    }
    .paycard input {
      width: 100%; padding: 10px; margin-top: 8px;
      border-radius: 5px; border: none; font-size: 16px;
    }
    .update-btn {
      margin-top: 10px;
      background: #00ff80;
      color: black;
      font-weight: bold;
      border-radius: 5px;
      padding: 10px;
      width: 100%;
    }
  </style>
</head>
<body>
  <h1>Admin Panel</h1>
  <button class="logout" onclick="logout()">Logout</button>
  <div id="not-admin" style="display:none; color: red;">Access Denied. Not an admin.</div>

  <div id="admin-panel" style="display:none;">

    <div class="section">
      <h2>üë• All Users</h2>
      <table id="user-table"><thead>
        <tr><th>Name</th><th>Email</th><th>Points</th><th>Balance</th><th>Status</th><th>Action</th></tr>
      </thead><tbody></tbody></table>
    </div>

    <div class="section">
      <h2>üü¢ Activation Requests</h2>
      <table id="act-table"><thead>
        <tr><th>Name</th><th>Sender</th><th>Amount</th><th>Txn ID</th><th>Action</th></tr>
      </thead><tbody></tbody></table>
    </div>

    <div class="section">
      <h2>üí∏ Withdraw Requests</h2>
      <table id="wd-table"><thead>
        <tr><th>Name</th><th>Method</th><th>Number</th><th>Points</th><th>Action</th></tr>
      </thead><tbody></tbody></table>
    </div>

    <div class="section">
      <h2>üîß Payment Numbers</h2>
      <div class="paycard">
        <h3>bKash</h3>
        <input id="bkash-input" placeholder="bKash Number">
        <button onclick="updateNumber('bkash')" class="update-btn">Update</button>
      </div>
      <div class="paycard">
        <h3>Nagad</h3>
        <input id="nagad-input" placeholder="Nagad Number">
        <button onclick="updateNumber('nagad')" class="update-btn">Update</button>
      </div>
      <div class="paycard">
        <h3>Rocket</h3>
        <input id="rocket-input" placeholder="Rocket Number">
        <button onclick="updateNumber('rocket')" class="update-btn">Update</button>
      </div>
      <div class="paycard">
        <h3>Upay</h3>
        <input id="upay-input" placeholder="Upay Number">
        <button onclick="updateNumber('upay')" class="update-btn">Update</button>
      </div>
    </div>

  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDy0QLtpLlzpAagSFtBW0J01jDmPTj3dns",
      authDomain: "rintiloveyou-6c20f.firebaseapp.com",
      databaseURL: "https://rintiloveyou-6c20f-default-rtdb.firebaseio.com",
      projectId: "rintiloveyou-6c20f",
      storageBucket: "rintiloveyou-6c20f.appspot.com",
      messagingSenderId: "544938645122",
      appId: "1:544938645122:web:2697a58c2410e63e65c69b"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const ADMIN_UID = "9xemsml7PCfsrsKT7t14Kd4exV92"; // ‚Üê ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ UID ‡¶¨‡¶∏‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá

    auth.onAuthStateChanged(user => {
      if (!user) {
        const email = prompt("Enter Admin Email:");
        const pass = prompt("Enter Password:");
        auth.signInWithEmailAndPassword(email, pass).catch(e => alert("Auth Failed"));
        return;
      }
      if (user.uid !== ADMIN_UID) {
        document.getElementById("not-admin").style.display = "block";
      } else {
        document.getElementById("admin-panel").style.display = "block";
        loadUsers();
        loadActivations();
        loadWithdraws();
        loadPaymentNumbers();
      }
    });

    function logout() {
      auth.signOut(); location.reload();
    }

    function loadUsers() {
      db.ref("users").once("value", snap => {
        const tbody = document.querySelector("#user-table tbody");
        tbody.innerHTML = "";
        snap.forEach(child => {
          const u = child.val(), uid = child.key;
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${u.name}</td><td>${u.email}</td><td>${u.points || 0}</td>
            <td>$${parseFloat(u.balance || 0).toFixed(2)}</td>
            <td>${u.isActive ? "‚úÖ Active" : "‚ùå Inactive"}</td>
            <td><button class="toggle" onclick="toggleActive('${uid}', ${!u.isActive})">${u.isActive ? "Deactivate" : "Activate"}</button></td>
          `;
          tbody.appendChild(row);
        });
      });
    }

    function toggleActive(uid, status) {
      db.ref("users/" + uid).update({ isActive: status });
      alert("‚úÖ Updated");
      loadUsers();
    }

    function loadActivations() {
      db.ref("activations").once("value", snap => {
        const tbody = document.querySelector("#act-table tbody");
        tbody.innerHTML = "";
        snap.forEach(child => {
          const uid = child.key;
          child.forEach(req => {
            const r = req.val(), id = req.key;
            db.ref("users/" + uid).once("value").then(uSnap => {
              const u = uSnap.val();
              const row = document.createElement("tr");
              row.innerHTML = `
                <td>${u.name}</td><td>${r.sender}</td><td>${r.amount}</td><td>${r.txn}</td>
                <td><button class="approve" onclick="approveActivation('${uid}', '${id}')">Approve</button>
                <button class="reject" onclick="rejectActivation('${uid}', '${id}')">Reject</button></td>
              `;
              tbody.appendChild(row);
            });
          });
        });
      });
    }

    function approveActivation(uid, id) {
      db.ref("users/" + uid).update({ isActive: true });
      db.ref("activations/" + uid + "/" + id).remove();
      alert("‚úÖ Approved"); loadActivations(); loadUsers();
    }

    function rejectActivation(uid, id) {
      db.ref("activations/" + uid + "/" + id).remove();
      alert("‚ùå Rejected"); loadActivations();
    }

    function loadWithdraws() {
      db.ref("withdraws").once("value", snap => {
        const tbody = document.querySelector("#wd-table tbody");
        tbody.innerHTML = "";
        snap.forEach(child => {
          const uid = child.key;
          child.forEach(req => {
            const r = req.val(), id = req.key;
            db.ref("users/" + uid).once("value").then(uSnap => {
              const u = uSnap.val();
              const row = document.createElement("tr");
              row.innerHTML = `
                <td>${u.name}</td><td>${r.method}</td><td>${r.number}</td><td>${r.points}</td>
                <td><button class="approve" onclick="approveWithdraw('${uid}', '${id}', ${r.points})">Approve</button>
                <button class="reject" onclick="rejectWithdraw('${uid}', '${id}')">Reject</button></td>
              `;
              tbody.appendChild(row);
            });
          });
        });
      });
    }

    function approveWithdraw(uid, id, points) {
      db.ref("withdraws/" + uid + "/" + id).update({ status: "approved" });
      db.ref("users/" + uid).update({ points: 0 });
      alert("‚úÖ Withdraw Approved"); loadWithdraws();
    }

    function rejectWithdraw(uid, id) {
      db.ref("withdraws/" + uid + "/" + id).update({ status: "rejected" });
      alert("‚ùå Withdraw Rejected"); loadWithdraws();
    }

    function loadPaymentNumbers() {
      db.ref("settings/paymentNumbers").once("value").then(snap => {
        const d = snap.val() || {};
        document.getElementById("bkash-input").value = d.bkash || "";
        document.getElementById("nagad-input").value = d.nagad || "";
        document.getElementById("rocket-input").value = d.rocket || "";
        document.getElementById("upay-input").value = d.upay || "";
      });
    }

    function updateNumber(method) {
      const val = document.getElementById(method + "-input").value;
      if (!val) return alert("Enter number");
      db.ref("settings/paymentNumbers/" + method).set(val).then(() => {
        alert(`${method} updated ‚úÖ`);
      });
    }
  </script>
</body>
</html>
