<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel - i-Bank BD</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-3xl mx-auto p-4 space-y-6">
    <h1 class="text-2xl font-bold text-center">Admin Panel - i-Bank BD</h1>

    <!-- Pending Users -->
    <section>
      <h2 class="text-xl font-semibold">অপেক্ষমান ইউজারসমূহ</h2>
      <div id="pending-users" class="space-y-2 mt-2"></div>
    </section>

    <!-- Approved Users -->
    <section>
      <h2 class="text-xl font-semibold">এপ্রুভড ইউজারসমূহ</h2>
      <div id="approved-users" class="space-y-2 mt-2"></div>
    </section>

    <!-- Recharge Requests -->
    <section>
      <h2 class="text-xl font-semibold">মোবাইল রিচার্জ রিকোয়েস্ট</h2>
      <div id="recharge-requests" class="space-y-2 mt-2"></div>
    </section>

    <!-- Bank Transfer Requests -->
    <section>
      <h2 class="text-xl font-semibold">ব্যাংক ট্রান্সফার রিকোয়েস্ট</h2>
      <div id="bank-requests" class="space-y-2 mt-2"></div>
    </section>

    <!-- Wallet Requests -->
    <section>
      <h2 class="text-xl font-semibold">ওয়ালেট রিকোয়েস্ট</h2>
      <div id="wallet-requests" class="space-y-2 mt-2"></div>
    </section>
  </div>

  <!-- Toast Notification Container -->
  <div id="toast-container" class="fixed top-4 right-4 space-y-2 z-50"></div>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDdQuA4izCiIYWJ3hNWLHVbglW5Ig2DHrM",
      authDomain: "i-bank-bd.firebaseapp.com",
      projectId: "i-bank-bd",
      storageBucket: "i-bank-bd.firebasestorage.app",
      messagingSenderId: "815383083283",
      appId: "1:815383083283:web:6ea26839b3a0bf22a982e6",
      measurementId: "G-CQWXB3KLWJ"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Toast Function
    function showToast(message, type = "success") {
      const container = document.getElementById("toast-container");
      const toast = document.createElement("div");

      toast.className = `px-4 py-2 rounded shadow-md text-white ${
        type === "success" ? "bg-green-500" : "bg-red-500"
      }`;
      toast.innerText = message;

      container.appendChild(toast);
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    // Approve user
    function approveUser(userId) {
      db.collection("users").doc(userId).update({ approved: true }).then(() => {
        showToast("ইউজার এপ্রুভ করা হয়েছে।");
      });
    }

    // Approve or Reject Request
    function updateStatus(collection, docId, status) {
      db.collection(collection).doc(docId).update({ status }).then(() => {
        showToast(
          `${collection} রিকোয়েস্ট ${status === "approved" ? "Approved" : "Rejected"} হয়েছে।`,
          status === "approved" ? "success" : "error"
        );
      });
    }

    // Load Users
    function loadUsers() {
      const pendingDiv = document.getElementById("pending-users");
      const approvedDiv = document.getElementById("approved-users");

      db.collection("users").onSnapshot(snapshot => {
        pendingDiv.innerHTML = "";
        approvedDiv.innerHTML = "";

        snapshot.forEach(doc => {
          const data = doc.data();
          const div = document.createElement("div");
          div.className = "p-3 bg-white border rounded flex justify-between items-center";
          div.innerHTML = `
            <div>
              <p><strong>${data.email}</strong></p>
              <p>Balance: ৳${data.balance || 0}</p>
            </div>
          `;

          if (data.approved) {
            approvedDiv.appendChild(div);
          } else {
            const btn = document.createElement("button");
            btn.innerText = "Approve";
            btn.className = "bg-green-500 text-white px-3 py-1 rounded";
            btn.onclick = () => approveUser(doc.id);
            div.appendChild(btn);
            pendingDiv.appendChild(div);
          }
        });
      });
    }

    // Load Recharge, Bank, Wallet Requests
    function loadRequests(collectionName, containerId, fields) {
      const container = document.getElementById(containerId);
      db.collection(collectionName)
        .where("status", "==", "pending")
        .onSnapshot(snapshot => {
          container.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const div = document.createElement("div");
            div.className = "bg-white border rounded p-3";
            let html = fields.map(f => `<p><strong>${f.label}:</strong> ${data[f.key]}</p>`).join("");
            html += `<p><strong>UID:</strong> ${data.uid}</p>`;
            const approveBtn = `<button class="bg-green-500 text-white px-3 py-1 rounded mr-2" onclick="updateStatus('${collectionName}', '${doc.id}', 'approved')">Approve</button>`;
            const rejectBtn = `<button class="bg-red-500 text-white px-3 py-1 rounded" onclick="updateStatus('${collectionName}', '${doc.id}', 'rejected')">Reject</button>`;
            div.innerHTML = html + `<div class="mt-2">${approveBtn}${rejectBtn}</div>`;
            container.appendChild(div);
          });
        });
    }

    // Init
    window.onload = () => {
      loadUsers();

      loadRequests("recharges", "recharge-requests", [
        { key: "number", label: "নাম্বার" },
        { key: "amount", label: "পরিমাণ" }
      ]);

      loadRequests("bankTransfers", "bank-requests", [
        { key: "bank", label: "ব্যাংক" },
        { key: "account", label: "একাউন্ট" },
        { key: "amount", label: "পরিমাণ" }
      ]);

      loadRequests("walletTransfers", "wallet-requests", [
        { key: "type", label: "ওয়ালেট টাইপ" },
        { key: "number", label: "নাম্বার" },
        { key: "amount", label: "পরিমাণ" }
      ]);
    };
  </script>
</body>
</html>
