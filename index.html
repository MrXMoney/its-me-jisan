<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Monetag App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    body { background: #121212; color: white; font-family: sans-serif; margin: 0; padding: 0; }
    .view { display: none; padding: 20px; max-width: 500px; margin: auto; }
    .view.active { display: block; }
    input, select, button {
      width: 100%; padding: 12px; margin-top: 10px;
      border-radius: 8px; border: none; font-size: 16px;
    }
    .btn { background: #00ff80; color: black; font-weight: bold; transition: 0.3s; }
    .btn:hover { background: #00cc66; }
    .btn.danger { background: #ff3b3b; color: white; }
    .card {
      background: #1f1f1f; padding: 20px;
      border-radius: 12px; margin-top: 15px;
      box-shadow: 0 4px 8px #0005;
    }
    ul { padding-left: 20px; text-align: left; }

    .pay-card {
      background: #222; padding: 15px;
      border-left: 4px solid #00ff80;
      border-radius: 10px; margin-bottom: 12px;
    }
    .copy-btn {
      background: #00ff80; color: black;
      padding: 6px 12px; border-radius: 6px;
      border: none; font-weight: bold;
      margin-left: 10px; cursor: pointer;
    }
    .copy-btn:hover { background: #00cc66; }
  </style>
</head>
<body>

<!-- Login -->
<div id="login-view" class="view active">
  <h2>🔐 Login</h2>
  <input id="login-email" placeholder="Email">
  <input id="login-pass" type="password" placeholder="Password">
  <button class="btn" onclick="login()">Login</button>
  <p><a href="#" onclick="showView('register-view')">Create account</a></p>
</div>

<!-- Register -->
<div id="register-view" class="view">
  <h2>📝 Register</h2>
  <input id="reg-name" placeholder="Your Name">
  <input id="reg-email" placeholder="Email">
  <input id="reg-pass" type="password" placeholder="Password">
  <button class="btn" onclick="register()">Register</button>
  <p><a href="#" onclick="showView('login-view')">Back to login</a></p>
</div>

<!-- Dashboard -->
<div id="home-view" class="view">
  <h2>👋 Welcome, <span id="user-name">User</span></h2>
  <p>Status: <span id="user-status">...</span></p>
  <div class="card"><h3>💰 Balance</h3><p>$<span id="user-balance">0.00</span></p></div>
  <div class="card"><h3>⭐ Points</h3><p><span id="user-points">0</span> pts</p></div>
  <div class="card">
    <button class="btn" onclick="showView('tasks-view')">🎯 Task</button>
    <button class="btn" onclick="showView('withdraw-view')">💸 Withdraw</button>
    <button class="btn" id="activate-btn" onclick="handleActivationClick()">🟢 Activate</button>
    <button class="btn danger" onclick="logout()">🚪 Logout</button>
  </div>
</div>

<!-- Task -->
<div id="tasks-view" class="view">
  <h3>🎯 Do Task</h3>
  <p>Click to earn point</p>
  <button class="btn" onclick="completeTask()">✅ Earn Point</button>
  <button class="btn" onclick="showView('home-view')">← Back</button>
</div>

<!-- Withdraw -->
<div id="withdraw-view" class="view">
  <h3>💸 Withdraw</h3>
  <input id="wd-number" placeholder="Your Number">
  <select id="wd-method">
    <option value="bKash">bKash</option>
    <option value="Nagad">Nagad</option>
    <option value="Rocket">Rocket</option>
    <option value="Upay">Upay</option>
  </select>
  <button class="btn" onclick="submitWithdraw()">Submit</button>
  <button class="btn" onclick="showView('home-view')">← Back</button>
</div>

<!-- Activation View -->
<div id="activation-view" class="view">
  <h3>🟢 Activate Account</h3>

  <div class="pay-card">
    <h3>📱 bKash</h3>
    <p><span id="bkash-num">Loading...</span>
    <button onclick="copyNumber('bkash-num')" class="copy-btn">📋 Copy</button></p>
  </div>

  <div class="pay-card">
    <h3>📱 Nagad</h3>
    <p><span id="nagad-num">Loading...</span>
    <button onclick="copyNumber('nagad-num')" class="copy-btn">📋 Copy</button></p>
  </div>

  <div class="pay-card">
    <h3>📱 Rocket</h3>
    <p><span id="rocket-num">Loading...</span>
    <button onclick="copyNumber('rocket-num')" class="copy-btn">📋 Copy</button></p>
  </div>

  <div class="pay-card">
    <h3>📱 Upay</h3>
    <p><span id="upay-num">Loading...</span>
    <button onclick="copyNumber('upay-num')" class="copy-btn">📋 Copy</button></p>
  </div>

  <input id="sender-number" placeholder="Sender Number">
  <input id="txn-id" placeholder="Transaction ID">
  <input id="amount" placeholder="Amount">
  <button class="btn" onclick="submitActivation()">Submit</button>
  <button class="btn" onclick="showView('home-view')">← Back</button>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDy0QLtpLlzpAagSFtBW0J01jDmPTj3dns",
  authDomain: "rintiloveyou-6c20f.firebaseapp.com",
  databaseURL: "https://rintiloveyou-6c20f-default-rtdb.firebaseio.com",
  projectId: "rintiloveyou-6c20f",
  storageBucket: "rintiloveyou-6c20f.appspot.com",
  messagingSenderId: "544938645122",
  appId: "1:544938645122:web:2697a58c2410e63e65c69b"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let currentUID = "", isActive = false;

function showView(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function register() {
  const name = document.getElementById("reg-name").value;
  const email = document.getElementById("reg-email").value;
  const pass = document.getElementById("reg-pass").value;
  const ref = new URLSearchParams(location.search).get("ref");
  auth.createUserWithEmailAndPassword(email, pass).then(res => {
    db.ref("users/" + res.user.uid).set({
      name, email, points: 0, balance: 0,
      isActive: false, referredBy: ref || null,
      createdAt: Date.now()
    });
    currentUID = res.user.uid;
    showHome(currentUID);
  }).catch(e => alert(e.message));
}

function login() {
  const email = document.getElementById("login-email").value;
  const pass = document.getElementById("login-pass").value;
  auth.signInWithEmailAndPassword(email, pass).then(res => {
    currentUID = res.user.uid;
    showHome(currentUID);
  }).catch(e => alert(e.message));
}

function logout() {
  auth.signOut().then(() => showView("login-view"));
}

function showHome(uid) {
  db.ref("users/" + uid).once("value").then(snap => {
    const u = snap.val();
    document.getElementById("user-name").innerText = u.name;
    document.getElementById("user-balance").innerText = parseFloat(u.balance || 0).toFixed(2);
    document.getElementById("user-points").innerText = u.points || 0;
    document.getElementById("user-status").innerText = u.isActive ? "✅ Active" : "❌ Inactive";
    isActive = u.isActive;
    document.getElementById("activate-btn").style.display = isActive ? "none" : "block";
    showView("home-view");
  });
}

function completeTask() {
  if (!isActive) return alert("Please activate account first.");
  db.ref("users/" + currentUID).once("value").then(snap => {
    let pts = (snap.val().points || 0) + 1;
    db.ref("users/" + currentUID).update({ points: pts });
    alert("✅ 1 point added!");
    showHome(currentUID);
  });
}

function submitWithdraw() {
  const number = document.getElementById("wd-number").value;
  const method = document.getElementById("wd-method").value;
  db.ref("users/" + currentUID).once("value").then(snap => {
    const u = snap.val();
    if (!u.isActive) return alert("Account not active.");
    if ((u.points || 0) < 50) return alert("Need 50+ points.");
    db.ref("withdraws/" + currentUID).push().set({
      number, method, points: u.points, date: new Date().toLocaleString()
    });
    db.ref("users/" + currentUID).update({ points: 0 });
    alert("✅ Request sent.");
    showHome(currentUID);
  });
}

function handleActivationClick() {
  loadPaymentNumberUI();
  showView("activation-view");
}

function loadPaymentNumberUI() {
  db.ref("settings/paymentNumbers").once("value").then(snap => {
    const data = snap.val() || {};
    document.getElementById("bkash-num").innerText = data.bkash || "Not set";
    document.getElementById("nagad-num").innerText = data.nagad || "Not set";
    document.getElementById("rocket-num").innerText = data.rocket || "Not set";
    document.getElementById("upay-num").innerText = data.upay || "Not set";
  });
}

function copyNumber(id) {
  const number = document.getElementById(id).innerText;
  navigator.clipboard.writeText(number).then(() => {
    alert("✅ Copied!");
  });
}

function submitActivation() {
  const sender = document.getElementById("sender-number").value;
  const txn = document.getElementById("txn-id").value;
  const amount = document.getElementById("amount").value;
  if (!sender || !txn || !amount) return alert("Fill all fields");
  db.ref("activations/" + currentUID).push().set({
    sender, txn, amount, date: new Date().toLocaleString()
  });
  alert("✅ Activation request submitted!");
  showView("home-view");
}

auth.onAuthStateChanged(user => {
  if (user) {
    currentUID = user.uid;
    showHome(currentUID);
  } else {
    showView("login-view");
  }
});
</script>
</body>
</html>
