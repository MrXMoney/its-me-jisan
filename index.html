<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Monetag App</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDy0QLtpLlzpAagSFtBW0J01jDmPTj3dns",
      authDomain: "rintiloveyou-6c20f.firebaseapp.com",
      databaseURL: "https://rintiloveyou-6c20f-default-rtdb.firebaseio.com",
      projectId: "rintiloveyou-6c20f",
      storageBucket: "rintiloveyou-6c20f.appspot.com",
      messagingSenderId: "544938645122",
      appId: "1:544938645122:web:2697a58c2410e63e65c69b"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
  </script>

  <style>
    body { background: #121212; color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; }
    .view { display: none; padding: 20px; max-width: 500px; margin: auto; }
    .view.active { display: block; }

    input, select, button {
      width: 100%; padding: 12px; margin-top: 10px;
      border-radius: 8px; border: none;
      font-size: 16px;
    }
    .btn { background: #00ff80; color: black; font-weight: bold; transition: 0.3s; }
    .btn:hover { background: #00cc66; }
    .btn.danger { background: #ff3b3b; color: white; }
    .card {
      background: #1f1f1f; padding: 20px;
      border-radius: 12px; margin-top: 15px;
      box-shadow: 0 4px 8px #0005;
      text-align: center;
    }
    ul { padding-left: 20px; text-align: left; }
  </style>
</head>
<body>

<!-- Login View -->
<div id="login-view" class="view active">
  <h2>ğŸ” Login</h2>
  <input id="login-email" placeholder="Email">
  <input id="login-pass" type="password" placeholder="Password">
  <button class="btn" onclick="login()">Login</button>
  <p><a href="#" onclick="showView('register-view')">Create account</a></p>
</div>

<!-- Register View -->
<div id="register-view" class="view">
  <h2>ğŸ“ Register</h2>
  <input id="reg-name" placeholder="Your Name">
  <input id="reg-email" placeholder="Email">
  <input id="reg-pass" type="password" placeholder="Password">
  <button class="btn" onclick="register()">Register</button>
  <p><a href="#" onclick="showView('login-view')">Back to login</a></p>
</div>

<!-- Home View -->
<div id="home-view" class="view">
  <h2>ğŸ‘‹ Welcome, <span id="user-name">User</span></h2>
  <p>Status: <span id="user-status">Loading...</span></p>

  <div class="card"><h3>ğŸ’° Balance</h3><p>$<span id="user-balance">0.00</span></p></div>
  <div class="card"><h3>â­ Points</h3><p><span id="user-points">0</span> pts</p></div>
  <div class="card">
    <button class="btn" onclick="showView('tasks-view')">ğŸ¯ Do Task</button>
    <button class="btn" onclick="showView('withdraw-view')">ğŸ’¸ Withdraw</button>
    <button class="btn" onclick="showView('activation-view')" id="activate-btn" style="display:none;">ğŸŸ¢ Activate</button>
    <button class="btn" onclick="showHistory()">ğŸ“œ History</button>
    <button class="btn danger" onclick="logout()">ğŸšª Logout</button>
  </div>
</div>

<!-- Task View -->
<div id="tasks-view" class="view">
  <h3>ğŸ¯ Complete Task</h3>
  <p>Earn 1 point per click</p>
  <button class="btn" onclick="completeTask()">âœ… Earn</button>
  <button class="btn" onclick="showView('home-view')">â† Back</button>
</div>

<!-- Withdraw View -->
<div id="withdraw-view" class="view">
  <h3>ğŸ’¸ Withdraw</h3>
  <input id="wd-number" placeholder="Your Number">
  <select id="wd-method">
    <option value="bKash">bKash</option>
    <option value="Nagad">Nagad</option>
    <option value="Rocket">Rocket</option>
  </select>
  <button class="btn" onclick="submitWithdraw()">Submit</button>
  <button class="btn" onclick="showView('home-view')">â† Back</button>
</div>

<!-- Activation View -->
<div id="activation-view" class="view">
  <h3>ğŸŸ¢ Activate Account</h3>
  <p>Send à§«à§¦à§³ to bKash: <b>01XXXXXXXXXX</b></p>
  <input id="sender-number" placeholder="Sender Number">
  <input id="txn-id" placeholder="Transaction ID">
  <input id="amount" placeholder="Amount">
  <button class="btn" onclick="submitActivation()">Submit</button>
  <button class="btn" onclick="showView('home-view')">â† Back</button>
</div>

<!-- History View -->
<div id="history-view" class="view">
  <h3>ğŸ“œ Withdraw History</h3>
  <ul id="history-list"></ul>
  <button class="btn" onclick="showView('home-view')">â† Back</button>
</div>

<script>
let currentUID = "", isActive = false;

function showView(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function register() {
  const name = document.getElementById("reg-name").value;
  const email = document.getElementById("reg-email").value;
  const pass = document.getElementById("reg-pass").value;
  const ref = new URLSearchParams(location.search).get("ref");
  auth.createUserWithEmailAndPassword(email, pass).then(res => {
    db.ref("users/" + res.user.uid).set({
      name, email, points: 0, balance: 0,
      isActive: false,
      referredBy: ref || null,
      createdAt: Date.now()
    });
    currentUID = res.user.uid;
    showHome(currentUID);
  }).catch(e => alert(e.message));
}

function login() {
  const email = document.getElementById("login-email").value;
  const pass = document.getElementById("login-pass").value;
  auth.signInWithEmailAndPassword(email, pass).then(res => {
    currentUID = res.user.uid;
    showHome(currentUID);
  }).catch(e => alert(e.message));
}

function logout() {
  auth.signOut().then(() => showView("login-view"));
}

function showHome(uid) {
  db.ref("users/" + uid).once("value").then(snap => {
    const u = snap.val();
    document.getElementById("user-name").innerText = u.name;
    document.getElementById("user-balance").innerText = parseFloat(u.balance || 0).toFixed(2);
    document.getElementById("user-points").innerText = u.points || 0;
    document.getElementById("user-status").innerText = u.isActive ? "âœ… Active" : "âŒ Inactive";
    isActive = u.isActive;
    document.getElementById("activate-btn").style.display = isActive ? "none" : "block";
    showView("home-view");
  });
}

function completeTask() {
  if (!isActive) return alert("Please activate your account.");
  db.ref("users/" + currentUID).once("value").then(snap => {
    const newPts = (snap.val().points || 0) + 1;
    db.ref("users/" + currentUID).update({ points: newPts });
    alert("âœ… Point Added!");
    showHome(currentUID);
  });
}

function submitWithdraw() {
  const number = document.getElementById("wd-number").value;
  const method = document.getElementById("wd-method").value;
  db.ref("users/" + currentUID).once("value").then(snap => {
    const u = snap.val();
    if (!u.isActive) return alert("Activate account first.");
    if ((u.points || 0) < 50) return alert("Need 50+ points.");
    const msg = `ğŸ’¸ *Withdraw Request*\nğŸ‘¤ ${u.name}\nğŸ“ ${number}\nğŸ’³ ${method}\nâ­ ${u.points} pts`;
    fetch(`https://api.telegram.org/bot7816709016:AAE3R4c3mX0fX1qE_QF2MwumGS0cAsWbpyg/sendMessage`, {
      method: "POST",
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ chat_id: "6374591042", text: msg, parse_mode: "Markdown" })
    });
    db.ref("withdraws/" + currentUID).push().set({
      number, method, points: u.points, date: new Date().toLocaleString()
    });
    db.ref("users/" + currentUID).update({ points: 0 });
    alert("âœ… Request Sent");
    showHome(currentUID);
  });
}

function submitActivation() {
  const sender = document.getElementById("sender-number").value;
  const txn = document.getElementById("txn-id").value;
  const amount = document.getElementById("amount").value;
  if (!sender || !txn || !amount) return alert("Fill all fields");
  db.ref("users/" + currentUID).once("value").then(uSnap => {
    const u = uSnap.val();
    const msg = `ğŸŸ¢ *Activation Request*\nğŸ‘¤ ${u.name}\nğŸ“ Sender: ${sender}\nğŸ’³ Amount: ${amount}\nTxn ID: ${txn}\nUID: ${currentUID}`;
    fetch(`https://api.telegram.org/bot7816709016:AAE3R4c3mX0fX1qE_QF2MwumGS0cAsWbpyg/sendMessage`, {
      method: "POST",
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ chat_id: "6374591042", text: msg, parse_mode: "Markdown" })
    }).then(res => res.json()).then(data => {
      if (data.ok) alert("âœ… Request sent!");
      else alert("âŒ Error");
    });
  });
}

function showHistory() {
  const list = document.getElementById("history-list");
  list.innerHTML = "";
  db.ref("withdraws/" + currentUID).once("value").then(snap => {
    snap.forEach(child => {
      const d = child.val();
      list.innerHTML += `<li>${d.date} - ${d.method} - ${d.points} pts</li>`;
    });
    showView("history-view");
  });
}

auth.onAuthStateChanged(user => {
  if (user) {
    currentUID = user.uid;
    showHome(currentUID);
  } else {
    showView("login-view");
  }
});
</script>
</body>
</html>
