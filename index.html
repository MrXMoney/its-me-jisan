<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>i-Bank BD</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-md mx-auto p-4" id="app">
    <h1 class="text-2xl font-bold mb-4 text-center">i-Bank BD</h1>

    <!-- Login/Register -->
    <div id="auth-section" class="space-y-4">
      <input id="email" type="email" placeholder="ইমেইল" class="w-full p-2 border rounded" />
      <input id="password" type="password" placeholder="পাসওয়ার্ড" class="w-full p-2 border rounded" />
      <button onclick="register()" class="bg-green-500 text-white p-2 rounded w-full">রেজিস্টার</button>
      <button onclick="login()" class="bg-blue-500 text-white p-2 rounded w-full">লগইন</button>
    </div>

    <!-- Home Page -->
    <div id="home-section" class="hidden space-y-4">
      <h2 class="text-xl font-semibold">হোমপেজ</h2>
      <div class="border p-3 rounded bg-white">
        <p><strong>ইউজার:</strong> <span id="user-email"></span></p>
        <p><strong>অবস্থা:</strong> <span id="approval-status"></span></p>
        <p><strong>ব্যালেন্স:</strong> <span id="user-balance">৳0</span></p>
      </div>

      <!-- Recharge -->
      <div class="bg-white p-3 rounded">
        <h3 class="font-semibold mb-2">মোবাইল রিচার্জ</h3>
        <input id="recharge-number" type="text" placeholder="মোবাইল নাম্বার" class="w-full p-2 border rounded mb-2" />
        <input id="recharge-amount" type="number" placeholder="টাকার পরিমাণ" class="w-full p-2 border rounded mb-2" />
        <button onclick="submitRecharge()" class="bg-purple-500 text-white p-2 rounded w-full">রিকোয়েস্ট</button>
      </div>

      <!-- Bank Transfer -->
      <div class="bg-white p-3 rounded">
        <h3 class="font-semibold mb-2">ব্যাংক ট্রান্সফার</h3>
        <input id="bank-name" type="text" placeholder="ব্যাংকের নাম" class="w-full p-2 border rounded mb-2" />
        <input id="account-number" type="text" placeholder="একাউন্ট নাম্বার" class="w-full p-2 border rounded mb-2" />
        <input id="bank-amount" type="number" placeholder="টাকার পরিমাণ" class="w-full p-2 border rounded mb-2" />
        <button onclick="submitBank()" class="bg-yellow-500 text-white p-2 rounded w-full">রিকোয়েস্ট</button>
      </div>

      <!-- Wallet Transfer -->
      <div class="bg-white p-3 rounded">
        <h3 class="font-semibold mb-2">মোবাইল ওয়ালেট</h3>
        <select id="wallet-type" class="w-full p-2 border rounded mb-2">
          <option>বিকাশ</option>
          <option>নগদ</option>
          <option>রকেট</option>
          <option>উপায়</option>
          <option>সেলফিন</option>
          <option>শিওরক্যাশ</option>
          <option>এম ক্যাশ</option>
        </select>
        <input id="wallet-number" type="text" placeholder="নাম্বার" class="w-full p-2 border rounded mb-2" />
        <input id="wallet-amount" type="number" placeholder="টাকার পরিমাণ" class="w-full p-2 border rounded mb-2" />
        <button onclick="submitWallet()" class="bg-red-500 text-white p-2 rounded w-full">রিকোয়েস্ট</button>
      </div>
    </div>
  </div>

  <!-- Firebase + App Logic -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDdQuA4izCiIYWJ3hNWLHVbglW5Ig2DHrM",
      authDomain: "i-bank-bd.firebaseapp.com",
      projectId: "i-bank-bd",
      storageBucket: "i-bank-bd.firebasestorage.app",
      messagingSenderId: "815383083283",
      appId: "1:815383083283:web:6ea26839b3a0bf22a982e6",
      measurementId: "G-CQWXB3KLWJ"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    function register() {
      const email = emailField.value;
      const pass = passwordField.value;
      auth.createUserWithEmailAndPassword(email, pass).then(({ user }) => {
        db.collection("users").doc(user.uid).set({
          email: user.email,
          approved: false,
          balance: 0
        });
        alert("রেজিস্ট্রেশন সফল, এডমিনের অনুমোদনের জন্য অপেক্ষা করুন।");
      }).catch(err => alert(err.message));
    }

    function login() {
      const email = emailField.value;
      const pass = passwordField.value;
      auth.signInWithEmailAndPassword(email, pass).then(({ user }) => {
        db.collection("users").doc(user.uid).get().then(doc => {
          if (doc.exists && doc.data().approved) {
            showHome(user.uid, doc.data());
          } else {
            alert("এখনো এডমিন এপ্রুভ করেননি।");
            auth.signOut();
          }
        });
      }).catch(err => alert(err.message));
    }

    function showHome(uid, data) {
      document.getElementById("auth-section").classList.add("hidden");
      document.getElementById("home-section").classList.remove("hidden");
      document.getElementById("user-email").innerText = data.email;
      document.getElementById("approval-status").innerText = "Approved";
      document.getElementById("user-balance").innerText = "৳" + data.balance;
    }

    function submitRecharge() {
      const uid = auth.currentUser.uid;
      db.collection("recharges").add({
        uid,
        number: rechargeNumber.value,
        amount: parseFloat(rechargeAmount.value),
        status: "pending",
        timestamp: new Date()
      });
      alert("রিচার্জ রিকোয়েস্ট পাঠানো হয়েছে।");
    }

    function submitBank() {
      const uid = auth.currentUser.uid;
      db.collection("bankTransfers").add({
        uid,
        bank: bankName.value,
        account: accountNumber.value,
        amount: parseFloat(bankAmount.value),
        status: "pending",
        timestamp: new Date()
      });
      alert("ব্যাংক ট্রান্সফার রিকোয়েস্ট পাঠানো হয়েছে।");
    }

    function submitWallet() {
      const uid = auth.currentUser.uid;
      db.collection("walletTransfers").add({
        uid,
        type: walletType.value,
        number: walletNumber.value,
        amount: parseFloat(walletAmount.value),
        status: "pending",
        timestamp: new Date()
      });
      alert("ওয়ালেট ট্রান্সফার রিকোয়েস্ট পাঠানো হয়েছে।");
    }

    const emailField = document.getElementById("email");
    const passwordField = document.getElementById("password");
    const rechargeNumber = document.getElementById("recharge-number");
    const rechargeAmount = document.getElementById("recharge-amount");
    const bankName = document.getElementById("bank-name");
    const accountNumber = document.getElementById("account-number");
    const bankAmount = document.getElementById("bank-amount");
    const walletType = document.getElementById("wallet-type");
    const walletNumber = document.getElementById("wallet-number");
    const walletAmount = document.getElementById("wallet-amount");
  </script>
</body>
</html>
